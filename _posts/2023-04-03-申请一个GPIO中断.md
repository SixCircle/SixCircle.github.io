---
layout: post_layout
title: 申请一个GPIO中断
time: 2023年04月03日 星期一
location: 南京
pulished: false
excerpt_separator: "##"
---



## 注册及初始化

### 函数

> `request_irq(unsigned int irq, irq_handler_t handler, unsigned long flags,const char *name, void *dev)`

- 参数

  unsigned int irq :           中断号

  irq_handler_t handler：中断服务函数

  unsigned long flags：   中断类型标志，即上升沿等触发方式

  const char *name： 中断名称

  void *dev：如果是共享中断，这里指定对应中断

## 获取当前gpio的中断号

### 函数

> `static inline int gpio_to_irq(unsigned int gpio)`

- 参数

    unsigned int gpio：GPIO编号

- 编号计算方法

    RK3568有5组 GPlO bank: GP100~GPI04,每组以A0~A7, BO~B7, CO~C7,DO~D7 作为编号区分用以下公式计算引脚编号:

    GPIO pin脚计算公式: pin = bank*32 + number

    GPIO 小组编号计算公式: number = group*8 +X

## 编写中断服务函数

回调函数原型

> `typedef irqreturn_t (*irq_handler_t)(int, void *);`

## 注销中断

​		在退出函数中使用

> `const void *free_irq(unsigned int irq, void *dev_id)`

- 参数

    unsigned int irq：中断号

    void *dev_id：在共享中断中，需要指定具体中断
